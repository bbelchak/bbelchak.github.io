<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Belchak.com</title>
<meta name="description" content="A blog about technology and leadership, and sometimes about leadership in technology.
">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/winter.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="A blog about technology and leadership, and sometimes about leadership in technology.
">
<meta name="twitter:creator" content="@BenBelchak">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="A blog about technology and leadership, and sometimes about leadership in technology.
">
<meta property="og:url" content="/page3/index.html">
<meta property="og:site_name" content="Belchak.com">





<link rel="canonical" href="/page3/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Belchak.com Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/avatar.jpg" alt="Ben Belchak photo" class="author-photo">
					<h4>Ben Belchak</h4>
					<p>Husband, father of four, Head of Site Reliability Engineering at Shazam. American in London.</p>
				</li>
				<li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:ben@belchak.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/BenBelchak"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/hekman"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				
				<li>
					<a href="https://linkedin.com/in/belchak"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/bbelchak"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				<li>
					<a href="ben-belchak"><i class="fa fa-fw fa-stack-exchange"></i> Stackexchange</a>
				</li>
				<li>
					<a href="https://instagram.com/bbelchak"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
				</li>
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">All Posts</a></li>
				<li><a href="/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img src="/images/winter.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Belchak.com</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2011-01-31T08:58:05+00:00"><a href="/2011/01/31/code-completion-for-python-and-django-in-vim/">January 31, 2011</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Ben Belchak">Ben Belchak</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2011/01/31/code-completion-for-python-and-django-in-vim/" rel="bookmark" title="Code Completion (IntelliSense) in VIM" itemprop="url">Code Completion (IntelliSense) in VIM</a></h1>
    
  </header>
  <div class="entry-content">
    
        <p><a href="http://www.vim.org/">VIM</a> has been my editor of choice for at least 15 years. I love how fast I can edit files, perform menial tasks, and wreak general havoc on any code project I am working on at any given moment. One of the things that I have missed about VIM from an IDE perspective has been code completion (a.k.a. “IntelliSense”). I have spent a lot of time on websites and man pages trying to figure out syntax and function names for several types of languages, and just recently discovered a long-included feature of VIM called omni completion, or Omnicomplete.</p>

<p>Since my life is mostly centered around <a href="http://www.djangoproject.com">django</a> these days, I will discuss how I’ve benefited from omnicomplete and how I’ve set it up in my own environment.</p>

<p>First, since django is a web development framework, I want to make sure that I can get omnicompletion for HTML, Python, JavaScript and CSS. Omnicompletion works for almost any programming language that VIM has syntax highlighting support for, and these languages are no exception.</p>

<p>Here’s what omnicomplete looks like for CSS files, for example:</p>

<p><img src="http://www.belchak.com/wp-content/uploads/2011/01/Screen-shot-2011-01-30-at-3.37.00-PM-1-30-11-300x213.png" width="300" alt="omnicomplete for vim" /></p>

<p>Setting this up for your django project is simple as pie. It is helpful to have all your django projects in one parent directory for the following setup. You can obviously customize this to your needs, but this is the way I’ve set it up in my environment.</p>

<p>Add the following to a script in a directory of your choosing (~/bin/vim_wrapper is where mine is):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="nb">export </span><span class="nv">PROJECT</span><span class="o">=</span><span class="sb">`</span>python -c <span class="s2">"import os; print os.path.basename(os.getcwd())"</span><span class="sb">`</span>
<span class="nb">export </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">"/path/to/your/projects/parent/directory/"</span>
<span class="nb">export </span><span class="nv">DJANGO_SETTINGS_MODULE</span><span class="o">=</span><span class="nv">$PROJECT</span>.settings vim
<span class="nv">$@</span></code></pre></div>

<p>Then add the following line to your ~/.bash_profile or equivalent:</p>

<p><code>alias vi="vim_wrapper"</code></p>

<p>Or, you can call your vim_wrapper script by hand. (<code>vim_wrapper file_to_edit.py</code>)</p>

<p>Next, add the following lines to your ~/.vimrc file:</p>

<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">filetype</span> plugin <span class="k">on</span>
autocmd <span class="nb">FileType</span> python <span class="k">set</span> omnifunc<span class="p">=</span>pythoncomplete#Complete
autocmd <span class="nb">FileType</span> javascript <span class="k">set</span> omnifunc<span class="p">=</span>javascriptcomplete#CompleteJS
autocmd <span class="nb">FileType</span> html <span class="k">set</span> omnifunc<span class="p">=</span>htmlcomplete#CompleteTags
autocmd <span class="nb">FileType</span> css <span class="k">set</span> omnifunc<span class="p">=</span>csscomplete#CompleteCSS</code></pre></div>

<p>I also prefer to re-map the default key binding (<c-x><c-o>) to <c-space>, so I accomplish this by also adding the following line to my ~/.vimrc file: `inoremap <c-space> <c-x><c-o>`</c-o></c-x></c-space></c-space></c-o></c-x></p>

<p>I also found <a href="http://blogs.gnome.org/lharris/2008/07/20/code-completion-with-vim-7/">this trick</a> today while searching around…</p>

<blockquote>
  <p>What this function does is that if there is no completion that could happen it will insert a tab.  Otherwise it checks to see if there is an omnifunction available and, if so, uses it. Otherwise it falls back to Dictionary completion if there is a dictionary defined.  Finally it resorts to simple known word completion.  In general, hitting the Tab key will just do the right thing for you in any given situation.</p>
</blockquote>

<p>Add the following to your ~/.vimrc and you should be good to go. It works like a charm for me.</p>

<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">function</span><span class="p">!</span> SuperCleverTab<span class="p">()</span>
    <span class="k">if</span> strpart<span class="p">(</span>getline<span class="p">(</span><span class="s1">'.'</span><span class="p">),</span> <span class="m">0</span><span class="p">,</span> <span class="k">col</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span> <span class="p">-</span> <span class="m">1</span><span class="p">)</span> <span class="p">=~</span> <span class="s1">'^\s*$'</span>
        <span class="k">return</span> <span class="s2">"\"</span>
    <span class="k">else</span>
        <span class="k">if</span> &amp;omnifunc <span class="p">!=</span> <span class="s1">''</span>
            <span class="k">return</span> <span class="s2">"\\"</span>
        <span class="k">elseif</span> &amp;dictionary <span class="p">!=</span> <span class="s1">''</span>
            <span class="k">return</span> <span class="s2">"\"</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="s2">"\"</span>
        <span class="k">endif</span>
    <span class="k">endif</span>
<span class="k">endfunction</span>

inoremap <span class="p">&lt;</span>Tab<span class="p">&gt;</span> <span class="p">&lt;</span>C<span class="p">-</span>R<span class="p">&gt;=</span>SuperCleverTab<span class="p">()&lt;</span><span class="k">cr</span><span class="p">&gt;</span></code></pre></div>

<p>If you find yourself writing code in other languages, the following lines in your vimrc should be adequate:</p>

<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">filetype</span> plugin <span class="k">on</span>
<span class="k">set</span> ofu<span class="p">=</span>syntaxcomplete#Complete</code></pre></div>

<p>You can now test that your installation works by changing directories to one of your django projects, firing up vim and running the following command: <code>:python from django import db</code></p>

<p>If you do not get a horrible error, you are good to go!</p>

<p>You can now access code completion by the following methods:</p>

<ul>
  <li>
    <p><code>&lt;C-p&gt;</code> - Shows a list of all local symbols. This is good if you do not have a tags file associated with the file you are editing.</p>
  </li>
  <li>
    <p><code>&lt;C-space&gt;</code> - Shows a list of all available symbols. You need to set up a tags file, which is outside the scope of this blog post</p>
  </li>
  <li>
    <p><code>&lt;C-x&gt;&lt;C-o&gt;</code> - The original keystroke sequence that we re-mapped C-space to.</p>
  </li>
  <li>
    <p><code>&lt;Tab&gt;</code> - The all-powerful tab!`</p>
  </li>
</ul>

<p>I hope you enjoy your new-found power with vim as much as I do!</p>

    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2011-01-27T17:04:04+00:00"><a href="/2011/01/27/django-database-migrations-with-south/">January 27, 2011</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Ben Belchak">Ben Belchak</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2011/01/27/django-database-migrations-with-south/" rel="bookmark" title="Django database migrations with South" itemprop="url">Django database migrations with South</a></h1>
    
  </header>
  <div class="entry-content">
    
        <p>I have been using <a href="http://djangoproject.com">django</a> for web development for almost a year now, and I just recently started using <a href="http://south.aeracode.org/">South</a> to do database migrations. To be fair, most of the work that I have been doing with databases has centered around <a href="http://www.mongodb.org">MongoDB</a> and schema-less document stores instead of a traditional RDBMS. Since Django does not come with any database migration tools, my standard approach was to make sure that my models are completely thought out before running the manage.py syncdb command. The lack of a good database migration tool was one of the things that originally had turned me off to django.</p>

<p>Enter South. South lets you manage your database in a way very similar to how <a href="http://rubyonrails.org">Ruby on Rails</a> works.</p>

<p>Converting a project to a South-managed project is very easy:</p>

<ol>
  <li>
    <p>Ensure that your database and models are completely synced up. (i.e. your models are not ahead of your database or vice-versa)</p>
  </li>
  <li>
    <p>Install South by running <code>[sudo] pip install south</code></p>
  </li>
  <li>
    <p>Add South to your <code>INSTALLED_APPS</code> list in the <code>settings.py</code> for your django project.</p>
  </li>
  <li>
    <p>Run <code>./manage.py syncdb</code> in your project root directory to add the South database tables to your database.</p>
  </li>
  <li>
    <p>If you have an existing application that you would like to conver to a South-managed application, run the following command: <code>./manage.py convert_to_south YOUR_APP_NAME</code> If not, go to the next step!</p>
  </li>
  <li>
    <p>Now you are ready to go! You can change one of your models and then proceed to the next step.</p>
  </li>
  <li>
    <p>Run the following command to get South to create an automatic migration for you: <code>./manage.py schemamigration YOUR_APP_NAME --auto</code></p>
  </li>
  <li>
    <p>Now you can apply your newly created migration to your database:<code>./manage.py migrate YOUR_APP_NAME</code></p>
  </li>
  <li>
    <p>Congratulations, you have performed your first database migration using South!</p>
  </li>
</ol>

<p>South lets you apply up to or back to any migration point by running a command like: <code>./manage.py migrate YOUR_APP_NAME 0001</code> (that command would take you back to your initial migration point. You can get a list of all your migrations and a description about each one by running <code>./manage.py migrate YOUR_APP_NAME --list</code>. This lists all of the migrations you have available and denotes with a (*) which ones have been applied.</p>

<p>South is great for working in a team. All migrations are stored in YOUR_APP_NAME/migrations, so you can simply add these to your VCS and all of your team  members will get all of your migrations. If there is a conflict in some of the migrations that you and a team member have been working on, South will detect it and let you <a href="http://south.aeracode.org/docs/tutorial/part5.html#team-workflow">merge the conflicts</a>.</p>

<p>All in all, I am really loving South. It makes working with an RDBMS and Django much more pleasant!</p>

    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2011-01-27T12:38:05+00:00"><a href="/2011/01/27/removing-old-ssh-fingerprints-from-your-known_hosts-the-quick-and-easy-way/">January 27, 2011</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Ben Belchak">Ben Belchak</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2011/01/27/removing-old-ssh-fingerprints-from-your-known_hosts-the-quick-and-easy-way/" rel="bookmark" title="Removing old ssh fingerprints from your known_hosts the quick and easy way" itemprop="url">Removing old ssh fingerprints from your known_hosts the quick and easy way</a></h1>
    
  </header>
  <div class="entry-content">
    
        <p>Ever have this problem? You just rebuilt a machine, and when you go to SSH into it, you get the following message:</p>

<pre><code>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
</code></pre>

<p>Many people just go edit their <code>~/.ssh/known_hosts</code> file and carry on. But there is a faster/better way!</p>

<p>OpenSSH comes with a command called <code>ssh-keygen</code> that allows you to generate and manage all your keys, including your ssh fingerprints.</p>

<p>Simple usage for this would be:</p>

<pre><code>ssh-keygen -R HOSTNAME
</code></pre>

    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2011-01-20T08:00:46+00:00"><a href="/2011/01/20/automatic-mongodb-backups-to-s3/">January 20, 2011</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Ben Belchak">Ben Belchak</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~2 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2011/01/20/automatic-mongodb-backups-to-s3/" rel="bookmark" title="Automatic MongoDB Backups to S3" itemprop="url">Automatic MongoDB Backups to S3</a></h1>
    
  </header>
  <div class="entry-content">
    
        <p>One of the big problems with hosting your own database solution is that you have to do backups for it on a regular basis. Not only do you need to do backups for it, but you need to also keep backups offsite. Luckily, <a href="http://aws.amazon.com/s3/">Amazon S3</a> allows a cheap and easy solution for your offsite backups.</p>

<p>I found a shell <a href="https://github.com/micahwedemeyer/automongobackup">script solution</a> for handling MongoDB backups, but it only does local backups. It keeps a nice history of recent backups, and rotates off the oldest ones when the threshold for age is reached. I modified the code to call a Python script that then synchronizes the newly created backup file to S3. I haven’t wired up any purging functionality yet, and I don’t know if I am going to. S3 storage is so cheap that it really doesn’t matter much. A complete solution would, of course, keep your local files and your remote off-site backups in S3 in sync, but there is also a case to be made for keeping a rich history of backups in the “cloud” so as to be able to revert to any point in history if necessary.</p>

<p>The script that does the magic to synchronize and purge old backups is written in Python, and uses the <a href="https://github.com/boto/boto">boto</a> library to quickly do the work.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">ACCESS_KEY</span><span class="o">=</span><span class="s">'YOUR_ACCESS_KEY'</span>
<span class="n">SECRET</span><span class="o">=</span><span class="s">'YOUR_SECRET_KEY'</span>
<span class="n">BUCKET_NAME</span><span class="o">=</span><span class="s">'YOUR_BACKUPS_BUCKET'</span> <span class="c">#note that you need to create this bucket first</span>

<span class="kn">from</span> <span class="nn">boto.s3.connection</span> <span class="kn">import</span> <span class="n">S3Connection</span>
<span class="kn">from</span> <span class="nn">boto.s3.key</span> <span class="kn">import</span> <span class="n">Key</span>

<span class="k">def</span> <span class="nf">save_file_in_s3</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="err">  </span> <span class="err"> </span><span class="n">conn</span> <span class="o">=</span> <span class="n">S3Connection</span><span class="p">(</span><span class="n">ACCESS_KEY</span><span class="p">,</span> <span class="n">SECRET</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">bucket</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">BUCKET_NAME</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">k</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">filename</span>
<span class="err">  </span> <span class="err"> </span><span class="n">k</span><span class="o">.</span><span class="n">set_contents_from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_file_from_s3</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="err">  </span> <span class="err"> </span><span class="n">conn</span> <span class="o">=</span> <span class="n">S3Connection</span><span class="p">(</span><span class="n">ACCESS_KEY</span><span class="p">,</span> <span class="n">SECRET</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">bucket</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">BUCKET_NAME</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">k</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">k</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">filename</span>
<span class="err">  </span> <span class="err"> </span><span class="n">k</span><span class="o">.</span><span class="n">get_contents_to_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">list_backup_in_s3</span><span class="p">():</span>
<span class="err">  </span> <span class="err"> </span><span class="n">conn</span> <span class="o">=</span> <span class="n">S3Connection</span><span class="p">(</span><span class="n">ACCESS_KEY</span><span class="p">,</span> <span class="n">SECRET</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">bucket</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">BUCKET_NAME</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">get_all_keys</span><span class="p">()):</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">print</span> <span class="s">"[</span><span class="si">%</span><span class="s">s] </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delete_all_backups</span><span class="p">():</span>
<span class="err">  </span> <span class="err"> </span><span class="c">#FIXME: validate filename exists</span>
<span class="err">  </span> <span class="err"> </span><span class="n">conn</span> <span class="o">=</span> <span class="n">S3Connection</span><span class="p">(</span><span class="n">ACCESS_KEY</span><span class="p">,</span> <span class="n">SECRET</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="n">bucket</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">get_bucket</span><span class="p">(</span><span class="n">BUCKET_NAME</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">get_all_keys</span><span class="p">()):</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">print</span> <span class="s">"deleting </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">key</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="err">  </span> <span class="err"> </span><span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">print</span> <span class="s">'Usage: </span><span class="si">%</span><span class="s">s  '</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="err">  </span> <span class="err"> </span><span class="k">else</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'set'</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">save_file_in_s3</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'get'</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">get_file_from_s3</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'list'</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">list_backup_in_s3</span><span class="p">()</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">elif</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">'delete'</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="n">delete_all_backups</span><span class="p">()</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">else</span><span class="p">:</span>
<span class="err">  </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span><span class="k">print</span> <span class="s">'Usage: </span><span class="si">%</span><span class="s">s  '</span> <span class="o">%</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></code></pre></div>

<p>There is obviously a lot more work to be done on this script, but it’s a start.</p>

<p>The appropriate setup for using this script and the AutoMongoBackup utility is to create a slave MongoDB node that receives synchronizations from the master. If you can handle having your Mongo instance locked for reads/writes while a backup is performed (i.e. you have a small database that backs up quickly) then you more than likely do not need to do the slave method.</p>

<p>Anyway, hope this helps! I’d love to hear other ideas about how else this can be done.</p>

    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2011-01-19T23:25:36+00:00"><a href="/2011/01/19/problems-with-facebook-api-and-m2crypto/">January 19, 2011</a></time></span><span class="author vcard"><span class="fn"><a href="/about/" title="About Ben Belchak">Ben Belchak</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="/2011/01/19/problems-with-facebook-api-and-m2crypto/" rel="bookmark" title="Problems with Facebook API and M2Crypto" itemprop="url">Problems with Facebook API and M2Crypto</a></h1>
    
  </header>
  <div class="entry-content">
    
        <p>After doing some crypto updates to a django application that I am working on, I discovered that the Facebook API was dog slow for retrieving any query using HTTPS. Turns out that the M2Crypto library apparently hijacks the SSL processing of urllib and mucks everything up. Thanks to <a href="http://hustoknow.blogspot.com/2011/01/m2crypto-and-facebooks-sdk-hangs.html">this handy blog post</a>, I was able to fix my Python implementation of the Facebook API and get things speeding along again.</p>

<p>The fix is basically to add the following lines before any <code>urllib.urlopen()</code> call (in my case, I only have two - one for GET and one for POST):</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">urllib</span><span class="o">.</span><span class="n">_urlopener</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">FancyURLopener</span><span class="p">()</span>
<span class="n">urllib</span><span class="o">.</span><span class="n">_urlopener</span><span class="o">.</span><span class="n">addheader</span><span class="p">(</span><span class="s">'Connection'</span><span class="p">,</span> <span class="s">'close'</span><span class="p">)</span></code></pre></div>


    
  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    
      
        <li><a href="/page2/" class="btn">Previous</a></li>
      
    

    
    
      <li><a href="">1</a></li>
    

    
    

    
    
    

    
      
        
        
        
        <li><a href="/page2/">2</a></li>
      
    

    
    

    
      <li><strong class="current-page">3</strong></li>
    

    
    
  </ul>
</div>


</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Ben Belchak. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-20863470-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


          

</body>
</html>